<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#1a0a0e" />
  <meta name="description" content="A once-in-a-lifetime Valentine moment ‚Äî crafted just for you." />

  <meta property="og:title" content="üíï A Moment Just For You üíï" />
  <meta property="og:description" content="A little love letter, just for you." />
  <meta property="og:type" content="website" />

  <title>üíï A Moment Just For You üíï</title>

  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíñ</text></svg>">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800&family=Cormorant+Garamond:wght@300;400;600;700&family=Raleway:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-deep: #0d0507;
      --bg-dark: #1a0a0e;
      --bg-card: rgba(30, 12, 18, 0.85);
      --gold: #d4a574;
      --gold-light: #e8c9a0;
      --rose: #c4586e;
      --rose-light: #e8829a;
      --rose-glow: rgba(196, 88, 110, 0.35);
      --blush: #f5c6d0;
      --cream: #faf0e6;
      --text: #f0e6e8;
      --text-muted: rgba(240, 230, 232, 0.6);
      --glass: rgba(30, 12, 18, 0.6);
      --glass-border: rgba(212, 165, 116, 0.15);
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
    html, body { height: 100%; }

    body {
      font-family: 'Raleway', system-ui, sans-serif;
      overflow-x: hidden;
      color: var(--text);
      background: var(--bg-deep);
      touch-action: pan-y;
    }

    .playfair { font-family: 'Playfair Display', serif; }
    .cormorant { font-family: 'Cormorant Garamond', serif; }

    /* Film grain overlay */
    .film-grain {
      position: fixed;
      inset: 0;
      z-index: 9000;
      pointer-events: none;
      opacity: 0.04;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      background-repeat: repeat;
    }

    /* Letterbox bars */
    .letterbox-top, .letterbox-bottom {
      position: fixed;
      left: 0;
      right: 0;
      height: 0;
      background: #000;
      z-index: 8500;
      transition: height 1.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .letterbox-top { top: 0; }
    .letterbox-bottom { bottom: 0; }
    .letterbox-top.active, .letterbox-bottom.active { height: 48px; }

    @media (min-width: 768px) {
      .letterbox-top.active, .letterbox-bottom.active { height: 64px; }
    }

    /* Vignette */
    .vignette {
      position: fixed;
      inset: 0;
      z-index: 1;
      pointer-events: none;
      background: radial-gradient(ellipse at center, transparent 40%, rgba(0, 0, 0, 0.6) 100%);
    }

    /* Ambient glow */
    .ambient-glow {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      background:
        radial-gradient(800px 600px at 20% 30%, rgba(196, 88, 110, 0.08), transparent 60%),
        radial-gradient(600px 500px at 80% 70%, rgba(212, 165, 116, 0.06), transparent 60%);
      animation: ambientShift 20s ease-in-out infinite alternate;
    }

    @keyframes ambientShift {
      0% { opacity: 0.7; }
      100% { opacity: 1; }
    }

    /* Progress bar */
    .progress-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      height: 2px;
      width: 0%;
      background: linear-gradient(90deg, var(--rose), var(--gold));
      z-index: 8600;
      transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* ===== LOADING SCREEN ===== */
    #loading {
      position: fixed;
      inset: 0;
      z-index: 3000;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-deep);
    }

    #loading .inner {
      text-align: center;
      opacity: 0;
      animation: fadeIn 1.5s ease forwards 0.3s;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    .loading-heart {
      font-size: 56px;
      animation: gentlePulse 2.8s ease-in-out infinite;
      filter: drop-shadow(0 0 30px var(--rose-glow));
    }

    @keyframes gentlePulse {
      0%, 100% { transform: scale(1); opacity: 0.9; }
      50% { transform: scale(1.08); opacity: 1; }
    }

    .loading-text {
      margin-top: 32px;
      font-family: 'Raleway', sans-serif;
      font-weight: 300;
      font-size: 11px;
      letter-spacing: 0.35em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .loading-bar-track {
      margin-top: 28px;
      width: 200px;
      height: 1px;
      background: rgba(240, 230, 232, 0.1);
      margin-left: auto;
      margin-right: auto;
      overflow: hidden;
      border-radius: 1px;
    }

    .loading-bar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--rose), var(--gold));
      transition: width 0.2s ease;
    }

    /* ===== START OVERLAY ===== */
    #startOverlay {
      position: fixed;
      inset: 0;
      z-index: 2500;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 24px;
      background: rgba(13, 5, 7, 0.92);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
    }

    #startOverlay .card {
      max-width: 480px;
      width: 100%;
      text-align: center;
      padding: 48px 32px;
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      background: var(--bg-card);
      box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5), 0 0 60px var(--rose-glow);
      opacity: 0;
      transform: translateY(20px);
      animation: revealCard 0.8s ease forwards 0.2s;
    }

    @keyframes revealCard {
      to { opacity: 1; transform: translateY(0); }
    }

    .start-icon {
      font-size: 48px;
      filter: drop-shadow(0 0 20px var(--rose-glow));
    }

    .start-title {
      margin-top: 20px;
      font-family: 'Playfair Display', serif;
      font-size: clamp(24px, 5vw, 36px);
      font-weight: 700;
      color: var(--cream);
      letter-spacing: 0.02em;
    }

    .start-sub {
      margin-top: 12px;
      font-size: 14px;
      font-weight: 300;
      color: var(--text-muted);
      line-height: 1.6;
    }

    .btn-group {
      margin-top: 32px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
    }

    @media (min-width: 480px) {
      .btn-group { flex-direction: row; justify-content: center; }
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-height: 48px;
      padding: 14px 32px;
      border: none;
      border-radius: 999px;
      font-family: 'Raleway', sans-serif;
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.06em;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease, opacity 0.3s ease;
      -webkit-tap-highlight-color: transparent;
    }

    .btn:active { transform: scale(0.97); }

    .btn-primary {
      background: linear-gradient(135deg, var(--rose), var(--rose-light));
      color: #fff;
      box-shadow: 0 8px 30px rgba(196, 88, 110, 0.35);
    }

    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 12px 40px rgba(196, 88, 110, 0.45); }

    .btn-secondary {
      background: rgba(240, 230, 232, 0.08);
      color: var(--text-muted);
      border: 1px solid rgba(240, 230, 232, 0.12);
    }

    .btn-secondary:hover { background: rgba(240, 230, 232, 0.12); color: var(--text); }

    /* ===== FLOATING PARTICLES ===== */
    #particles {
      position: fixed;
      inset: 0;
      z-index: 2;
      pointer-events: none;
      overflow: hidden;
    }

    .particle {
      position: absolute;
      border-radius: 50%;
      background: var(--gold);
      opacity: 0;
      animation: particleFloat linear infinite;
    }

    @keyframes particleFloat {
      0% { transform: translateY(100vh) scale(0); opacity: 0; }
      10% { opacity: 0.4; }
      90% { opacity: 0.4; }
      100% { transform: translateY(-10vh) scale(1); opacity: 0; }
    }

    .particle-rose {
      background: var(--rose);
      box-shadow: 0 0 6px var(--rose-glow);
    }

    /* ===== MAIN APP ===== */
    #app {
      position: relative;
      min-height: 100vh;
      z-index: 3;
      display: none;
      flex-direction: column;
      padding: calc(24px + var(--safe-top)) 20px calc(24px + var(--safe-bottom));
    }

    #app.visible {
      display: flex;
    }

    /* Header */
    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 0;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand-icon {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      display: grid;
      place-items: center;
      background: rgba(196, 88, 110, 0.15);
      border: 1px solid rgba(196, 88, 110, 0.2);
      font-size: 18px;
    }

    .brand-text {
      font-size: 13px;
      font-weight: 500;
      color: var(--gold-light);
    }

    .brand-date {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .controls {
      display: flex;
      gap: 8px;
    }

    .ctrl-btn {
      background: rgba(240, 230, 232, 0.06);
      border: 1px solid rgba(240, 230, 232, 0.08);
      border-radius: 999px;
      padding: 8px 14px;
      color: var(--text-muted);
      font-size: 12px;
      font-family: 'Raleway', sans-serif;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease;
    }

    .ctrl-btn:hover { background: rgba(240, 230, 232, 0.1); color: var(--text); }

    /* Stage */
    .stage-wrapper {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .stage {
      width: min(720px, 100%);
    }

    .stage-card {
      padding: 40px 28px;
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      background: var(--bg-card);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4), 0 0 40px rgba(196, 88, 110, 0.08);
    }

    @media (min-width: 640px) {
      .stage-card { padding: 56px 48px; }
    }

    /* Steps */
    .step {
      display: none;
      text-align: center;
      animation: cineFadeIn 0.8s ease forwards;
    }

    .step.active { display: block; }

    @keyframes cineFadeIn {
      from { opacity: 0; transform: translateY(16px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .step-title {
      font-family: 'Playfair Display', serif;
      font-size: clamp(28px, 6vw, 52px);
      font-weight: 700;
      line-height: 1.1;
      color: var(--cream);
      letter-spacing: 0.01em;
    }

    .step-accent {
      display: inline-block;
      color: var(--gold);
    }

    .step-body {
      margin-top: 20px;
      font-family: 'Cormorant Garamond', serif;
      font-size: clamp(16px, 3vw, 22px);
      font-weight: 300;
      line-height: 1.7;
      color: var(--text-muted);
      font-style: italic;
    }

    .step-actions {
      margin-top: 36px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
    }

    @media (min-width: 480px) {
      .step-actions { flex-direction: row; justify-content: center; }
    }

    /* Progress dots */
    .dots {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 32px;
    }

    .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: rgba(240, 230, 232, 0.15);
      transition: background 0.4s ease, transform 0.4s ease, box-shadow 0.4s ease;
    }

    .dot.active {
      background: var(--gold);
      transform: scale(1.4);
      box-shadow: 0 0 10px rgba(212, 165, 116, 0.4);
    }

    /* Photo */
    .photo {
      width: 100%;
      max-height: 300px;
      object-fit: cover;
      border-radius: 16px;
      border: 1px solid var(--glass-border);
      box-shadow: 0 16px 50px rgba(0, 0, 0, 0.4);
      margin-top: 24px;
    }

    /* Proposal text */
    .proposal-text {
      margin-top: 24px;
      font-family: 'Playfair Display', serif;
      font-size: clamp(22px, 5vw, 38px);
      font-weight: 700;
      color: var(--rose-light);
      text-shadow: 0 0 40px var(--rose-glow);
    }

    /* Footer line */
    .footer-line {
      margin-top: 20px;
      text-align: center;
      font-size: 11px;
      color: var(--text-muted);
      letter-spacing: 0.05em;
    }

    /* ===== CELEBRATION ===== */
    #celebration {
      position: fixed;
      inset: 0;
      z-index: 2200;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 24px;
      background: var(--bg-deep);
      overflow: hidden;
    }

    .cel-glow {
      position: absolute;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(600px 500px at 50% 40%, rgba(196, 88, 110, 0.15), transparent 60%),
        radial-gradient(400px 400px at 30% 60%, rgba(212, 165, 116, 0.1), transparent 60%);
      animation: ambientShift 12s ease-in-out infinite alternate;
    }

    .cel-card {
      position: relative;
      max-width: 640px;
      width: 100%;
      padding: 48px 32px;
      text-align: center;
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      background: var(--bg-card);
      box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5), 0 0 60px var(--rose-glow);
      opacity: 0;
      transform: scale(0.95);
      animation: celebReveal 1s ease forwards 0.3s;
    }

    @keyframes celebReveal {
      to { opacity: 1; transform: scale(1); }
    }

    .cel-heart {
      font-size: 64px;
      animation: gentlePulse 2.8s ease-in-out infinite;
      filter: drop-shadow(0 0 30px var(--rose-glow));
    }

    .cel-title {
      margin-top: 20px;
      font-family: 'Playfair Display', serif;
      font-size: clamp(32px, 7vw, 56px);
      font-weight: 800;
      color: var(--cream);
      text-shadow: 0 0 40px var(--rose-glow);
    }

    .cel-message {
      margin-top: 20px;
      font-family: 'Cormorant Garamond', serif;
      font-size: clamp(16px, 3vw, 22px);
      font-weight: 300;
      line-height: 1.8;
      color: var(--text-muted);
    }

    .cel-valentine {
      margin-top: 28px;
      font-family: 'Playfair Display', serif;
      font-size: clamp(20px, 4vw, 32px);
      font-weight: 700;
      color: var(--gold);
    }

    .cel-hint {
      margin-top: 28px;
      font-size: 11px;
      color: var(--text-muted);
      letter-spacing: 0.04em;
    }

    .cel-actions {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    /* Celebration particles */
    .cel-particle {
      position: absolute;
      pointer-events: none;
      animation: celFloat linear infinite;
      will-change: transform, opacity;
    }

    @keyframes celFloat {
      0% { transform: translateY(0) rotate(0deg) scale(0); opacity: 0; }
      10% { opacity: 0.8; transform: translateY(-10vh) rotate(36deg) scale(1); }
      90% { opacity: 0.8; }
      100% { transform: translateY(-110vh) rotate(360deg) scale(0.5); opacity: 0; }
    }

    /* Firework burst */
    .fw-particle {
      position: absolute;
      width: 3px;
      height: 3px;
      border-radius: 50%;
      animation: fwBurst 1.6s ease-out forwards;
      will-change: transform, opacity;
    }

    @keyframes fwBurst {
      0% { transform: translate(0, 0) scale(1); opacity: 1; }
      100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
    }

    /* ===== MODAL ===== */
    #modalOverlay {
      position: fixed;
      inset: 0;
      z-index: 4000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 24px;
      background: rgba(13, 5, 7, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }

    #modal {
      max-width: 420px;
      width: 100%;
      padding: 36px 28px;
      text-align: center;
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      background: var(--bg-card);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      transform: scale(0.95);
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }

    #modalOverlay.show #modal {
      transform: scale(1);
      opacity: 1;
    }

    .modal-icon { font-size: 48px; }
    .modal-text {
      margin-top: 16px;
      font-family: 'Cormorant Garamond', serif;
      font-size: 20px;
      color: var(--rose-light);
      font-weight: 600;
    }

    /* Notification toast */
    .notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-80px);
      padding: 12px 24px;
      border-radius: 999px;
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      color: var(--text);
      font-size: 13px;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
      z-index: 5000;
      opacity: 0;
      transition: transform 0.4s ease, opacity 0.4s ease;
    }

    .notification.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* Cursor trail */
    .cursor-trail {
      position: fixed;
      pointer-events: none;
      z-index: 1800;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: var(--gold);
      box-shadow: 0 0 8px var(--gold);
      animation: trailFade 0.8s ease-out forwards;
      will-change: transform, opacity;
    }

    @keyframes trailFade {
      0% { opacity: 0.7; transform: scale(1); }
      100% { opacity: 0; transform: scale(0) translateY(-20px); }
    }

    /* Grow/shrink for Yes/No buttons */
    @keyframes btnPulse {
      0% { transform: scale(var(--current-scale, 1)); }
      50% { transform: scale(calc(var(--current-scale, 1) * 1.08)); }
      100% { transform: scale(var(--current-scale, 1)); }
    }

    .btn-pulse { animation: btnPulse 0.4s ease; }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .loading-heart, .cel-heart { animation: none !important; }
      .particle, .cel-particle, .fw-particle { animation: none !important; display: none !important; }
      .ambient-glow { animation: none !important; }
      .cursor-trail { display: none !important; }
    }

    html[data-motion="reduced"] .loading-heart,
    html[data-motion="reduced"] .cel-heart { animation: none !important; }
    html[data-motion="reduced"] .particle,
    html[data-motion="reduced"] .cel-particle,
    html[data-motion="reduced"] .fw-particle { display: none !important; }
    html[data-motion="reduced"] .ambient-glow { animation: none !important; }
    html[data-motion="reduced"] .cursor-trail { display: none !important; }

    /* Hidden utility */
    .hidden { display: none !important; }

    /* No-select */
    .no-select { user-select: none; -webkit-user-select: none; }
  </style>
</head>
<body class="no-select">

  <!-- Film grain overlay -->
  <div class="film-grain" aria-hidden="true"></div>

  <!-- Letterbox bars -->
  <div class="letterbox-top" id="letterboxTop" aria-hidden="true"></div>
  <div class="letterbox-bottom" id="letterboxBottom" aria-hidden="true"></div>

  <!-- Vignette -->
  <div class="vignette" aria-hidden="true"></div>

  <!-- Ambient glow -->
  <div class="ambient-glow" aria-hidden="true"></div>

  <!-- Progress bar -->
  <div class="progress-bar" id="progressBar" aria-hidden="true"></div>

  <!-- Floating particles -->
  <div id="particles" aria-hidden="true"></div>

  <!-- ===== LOADING ===== -->
  <div id="loading">
    <div class="inner">
      <div class="loading-heart" aria-hidden="true">üíñ</div>
      <div class="loading-text">Preparing something special</div>
      <div class="loading-bar-track">
        <div class="loading-bar-fill" id="loadingFill"></div>
      </div>
    </div>
  </div>

  <!-- ===== START OVERLAY ===== -->
  <div id="startOverlay">
    <div class="card">
      <div class="start-icon" aria-hidden="true">üíå</div>
      <h2 class="start-title">A Letter For You</h2>
      <p class="start-sub">
        Tap <strong>Begin</strong> when you're ready.<br>
        Music is optional üéµ
      </p>
      <div class="btn-group">
        <button id="beginBtn" class="btn btn-primary">Begin ‚ú®</button>
        <button id="muteBtn" class="btn btn-secondary">Silent ü§´</button>
      </div>
      <p style="margin-top: 20px; font-size: 11px; color: var(--text-muted);">
        Turn your volume up for the full experience.
      </p>
    </div>
  </div>

  <!-- ===== MAIN APP ===== -->
  <div id="app">
    <header class="app-header">
      <div class="brand">
        <div class="brand-icon" aria-hidden="true">üíû</div>
        <div>
          <div id="toLine" class="brand-text">To my favorite person</div>
          <div id="dateLine" class="brand-date"></div>
        </div>
      </div>
      <div class="controls">
        <button id="backBtn" class="ctrl-btn hidden" title="Go back">‚Üê</button>
        <button id="musicToggle" class="ctrl-btn" aria-label="Toggle music">üîá Music</button>
        <button id="motionToggle" class="ctrl-btn" aria-label="Toggle calm mode">ü´ß Calm</button>
      </div>
    </header>

    <div class="stage-wrapper">
      <div class="stage">
        <div class="stage-card">

          <!-- Step 1 -->
          <section id="step1" class="step active">
            <h1 class="step-title">
              A little journey,<br><span class="step-accent">just for you</span> üíå
            </h1>
            <p class="step-body">
              <span id="quoteText">"You are my today and all of my tomorrows."</span>
            </p>
            <div class="step-actions">
              <button id="s1Yes" class="btn btn-primary">Let's go üíñ</button>
              <button id="s1No" class="btn btn-secondary">Not yet‚Ä¶</button>
            </div>
            <div class="dots">
              <div class="dot active" id="dot1"></div>
              <div class="dot" id="dot2"></div>
              <div class="dot" id="dot3"></div>
            </div>
          </section>

          <!-- Step 2 -->
          <section id="step2" class="step">
            <h2 class="step-title">
              One tiny <span class="step-accent">promise</span>
            </h2>
            <p class="step-body">
              Will you choose us, every single day?
            </p>
            <div class="step-actions">
              <button id="s2Yes" class="btn btn-primary">Always ‚ù§Ô∏è</button>
              <button id="s2No" class="btn btn-secondary">Hmm‚Ä¶ maybe</button>
            </div>
            <div class="dots">
              <div class="dot" id="dot1b"></div>
              <div class="dot active" id="dot2b"></div>
              <div class="dot" id="dot3b"></div>
            </div>
          </section>

          <!-- Step 3 -->
          <section id="step3" class="step">
            <h2 class="step-title">
              Here goes <span class="step-accent">everything</span>‚Ä¶
            </h2>
            <div style="margin-top: 24px;">
              <p class="step-body" style="font-style: normal;">
                <span id="herNameInline" style="color: var(--gold); font-weight: 600;">My Love</span>,<br>
                you are my calm in the chaos,<br>
                my warmth on cold days,<br>
                and the reason I smile for no reason at all.
              </p>
              <p class="proposal-text">
                Will you be my Valentine? üíï
              </p>
            </div>
            <img id="photo" class="photo hidden" alt="A special photo" />
            <div class="step-actions">
              <button id="finalYes" class="btn btn-primary" style="font-size: 16px;">YES, forever! üíû</button>
              <button id="finalNo" class="btn btn-secondary" style="font-size: 16px;">Not yet</button>
            </div>
            <div class="dots">
              <div class="dot" id="dot1c"></div>
              <div class="dot" id="dot2c"></div>
              <div class="dot active" id="dot3c"></div>
            </div>
          </section>

        </div>

        <div class="footer-line">
          Written with love ¬∑ <span id="fromLine">from someone who adores you</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== CELEBRATION ===== -->
  <div id="celebration">
    <div class="cel-glow" aria-hidden="true"></div>
    <div id="celParticles" aria-hidden="true"></div>
    <div id="celFireworks" aria-hidden="true"></div>

    <div class="cel-card">
      <div class="cel-heart" aria-hidden="true">üíñ</div>
      <h1 class="cel-title">You said yes! üíû</h1>
      <p class="cel-message">
        <span style="font-weight: 600; color: var(--cream);">My love</span>, you've just made me the happiest person alive.
        <br>I promise to cherish every moment with you ‚Äî today, tomorrow, and always.
      </p>
      <p class="cel-valentine">
        Happy Valentine's Day, <span id="herNameCelebration">my everything</span>. üåπ
      </p>
      <p class="cel-hint">Take a screenshot to keep this moment forever.</p>
      <div class="cel-actions">
        <button id="shareBtn" class="btn btn-secondary" style="font-size: 12px;">Share üíï</button>
        <button id="copyLinkBtn" class="btn btn-secondary" style="font-size: 12px;">Copy link üîó</button>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="modalOverlay">
    <div id="modal">
      <div class="modal-icon" aria-hidden="true">üíî</div>
      <p id="modalText" class="modal-text"></p>
      <div style="margin-top: 24px;">
        <button id="modalOk" class="btn btn-primary">Okay üíï</button>
      </div>
    </div>
  </div>

  <!-- Audio -->
  <audio id="bgMusic" loop preload="auto">
    <source src="https://assets.codepen.io/831041/valentine-romantic-piano.mp3" type="audio/mpeg" />
  </audio>

  <!-- Notification -->
  <div id="notification" class="notification"></div>

  <noscript>
    <div style="padding: 24px; background: #1a0a0e; color: #f0e6e8; text-align: center;">
      This page needs JavaScript to run the Valentine experience. üíñ
    </div>
  </noscript>

  <script>
    // ========================================================
    // CINEMATIC VALENTINE EXPERIENCE
    // ========================================================

    // ---------- Personalization (edit or use URL params) ----------
    // URL params: ?to=HerName&from=YourName&photo=https://...jpg
    const DEFAULTS = {
      to: "My Love",
      from: "someone who adores you",
      photo: ""
    };

    const QUOTES = [
      "You are my today and all of my tomorrows.",
      "Every love story is beautiful ‚Äî but ours is my favorite.",
      "My heart is perfect because you are inside.",
      "Forever sounds pretty good with you.",
      "You make my heart smile in ways I can't explain."
    ];

    const NO_MESSAGES = [
      "Are you sure? ü•∫",
      "Pretty please? üíï",
      "One more chance? üåπ",
      "I'll wait for you üíñ"
    ];

    const YES_GROW_INCREMENT = 0.12;
    const YES_MAX_SCALE = 1.8;
    const NO_SHRINK_DECREMENT = 0.08;
    const NO_MIN_SCALE = 0.5;

    // ---------- State ----------
    const STATE_KEY = "val_cine_state_v1";
    const state = {
      step: 1,
      yes: false,
      noCount: 0,
      musicOn: false,
      ...loadStateSafe()
    };

    // ---------- Elements ----------
    const htmlEl = document.documentElement;
    const progressBar = document.getElementById("progressBar");
    const letterboxTop = document.getElementById("letterboxTop");
    const letterboxBottom = document.getElementById("letterboxBottom");

    const loading = document.getElementById("loading");
    const loadingFill = document.getElementById("loadingFill");

    const startOverlay = document.getElementById("startOverlay");
    const beginBtn = document.getElementById("beginBtn");
    const muteBtn = document.getElementById("muteBtn");

    const app = document.getElementById("app");
    const particles = document.getElementById("particles");

    const toLine = document.getElementById("toLine");
    const fromLine = document.getElementById("fromLine");
    const dateLine = document.getElementById("dateLine");
    const quoteText = document.getElementById("quoteText");

    const step1 = document.getElementById("step1");
    const step2 = document.getElementById("step2");
    const step3 = document.getElementById("step3");

    const s1Yes = document.getElementById("s1Yes");
    const s1No = document.getElementById("s1No");
    const s2Yes = document.getElementById("s2Yes");
    const s2No = document.getElementById("s2No");
    const finalYes = document.getElementById("finalYes");
    const finalNo = document.getElementById("finalNo");

    const herNameInline = document.getElementById("herNameInline");
    const photoEl = document.getElementById("photo");

    const celebration = document.getElementById("celebration");
    const herNameCelebr = document.getElementById("herNameCelebration");
    const celParticles = document.getElementById("celParticles");
    const celFireworks = document.getElementById("celFireworks");

    const modalOverlay = document.getElementById("modalOverlay");
    const backBtn = document.getElementById("backBtn");
    const shareBtn = document.getElementById("shareBtn");
    const copyLinkBtn = document.getElementById("copyLinkBtn");
    const modalText = document.getElementById("modalText");
    const modalOk = document.getElementById("modalOk");

    const musicToggle = document.getElementById("musicToggle");
    const motionToggle = document.getElementById("motionToggle");
    const music = document.getElementById("bgMusic");

    // ---------- Helpers ----------
    function loadStateSafe() {
      try {
        const raw = localStorage.getItem(STATE_KEY);
        return raw ? JSON.parse(raw) : {};
      } catch (e) { return {}; }
    }

    function saveStateSafe() {
      try { localStorage.setItem(STATE_KEY, JSON.stringify(state)); } catch (e) {}
    }

    function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }

    function vibrate(ms) {
      try { if ("vibrate" in navigator) navigator.vibrate(ms); } catch (e) {}
    }

    function getConfig() {
      const params = new URLSearchParams(window.location.search);
      const to = (params.get("to") || params.get("name") || DEFAULTS.to).slice(0, 40);
      const from = (params.get("from") || DEFAULTS.from).slice(0, 40);
      const rawPhoto = params.get("photo") || DEFAULTS.photo;
      const photo = (/^https?:\/\//i.test(rawPhoto) || rawPhoto.startsWith("./") || rawPhoto.startsWith("../")) ? rawPhoto : "";
      return { to, from, photo };
    }

    const CONFIG = getConfig();

    // ---------- Loading ----------
    function runLoader() {
      // Show letterbox bars during loading
      requestAnimationFrame(() => {
        letterboxTop.classList.add("active");
        letterboxBottom.classList.add("active");
      });

      let pct = 0;
      const tick = setInterval(() => {
        pct += Math.random() * 14;
        pct = clamp(pct, 0, 100);
        loadingFill.style.width = Math.floor(pct) + "%";
        if (pct >= 100) {
          clearInterval(tick);
          setTimeout(() => {
            loading.style.opacity = "0";
            loading.style.transition = "opacity 1.4s ease";
            setTimeout(() => {
              loading.style.display = "none";
              startOverlay.style.display = "flex";
            }, 1400);
          }, 600);
        }
      }, 160);
    }

    // ---------- Date line ----------
    function setDateLine() {
      const now = new Date();
      const opts = { weekday: "long", year: "numeric", month: "long", day: "numeric" };
      const nice = now.toLocaleDateString(undefined, opts);
      if (now.getMonth() === 1 && now.getDate() === 14) {
        dateLine.textContent = "üåπ Happy Valentine's Day üåπ";
      } else {
        dateLine.textContent = nice;
      }
    }

    // ---------- Motion ----------
    function syncMotion() {
      const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
      if (typeof state.reducedMotion !== "boolean") state.reducedMotion = prefersReduced;
      htmlEl.dataset.motion = state.reducedMotion ? "reduced" : "full";
      motionToggle.textContent = state.reducedMotion ? "ü´ß Calm on" : "ü´ß Calm";
      saveStateSafe();
    }

    motionToggle.addEventListener("click", () => {
      state.reducedMotion = !state.reducedMotion;
      syncMotion();
      initParticles();
      if (celebration.style.display === "flex") {
        clearCelebrationFx();
        if (!state.reducedMotion) {
          startCelParticles();
          startFireworks();
        }
      }
    });

    // ---------- Music ----------
    let audioCtx = null;
    let melodyTimer = null;

    function stopWebAudio() {
      if (melodyTimer) { clearTimeout(melodyTimer); melodyTimer = null; }
      if (audioCtx) {
        try { audioCtx.close(); } catch (e) {}
        audioCtx = null;
      }
    }

    function playWebAudioLoop() {
      stopWebAudio();
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const master = audioCtx.createGain();
      master.gain.value = 0.08;
      master.connect(audioCtx.destination);

      const notes = [
        { f: 523.25, d: 0.45 }, { f: 587.33, d: 0.45 }, { f: 659.25, d: 0.45 },
        { f: 698.46, d: 0.45 }, { f: 783.99, d: 0.95 }, { f: 659.25, d: 0.45 },
        { f: 523.25, d: 0.95 }
      ];

      const startAt = audioCtx.currentTime + 0.02;
      let t = startAt;

      notes.forEach(n => {
        const osc = audioCtx.createOscillator();
        osc.type = "sine";
        osc.frequency.value = n.f;
        const g = audioCtx.createGain();
        g.gain.setValueAtTime(0, t);
        g.gain.linearRampToValueAtTime(0.06, t + 0.02);
        g.gain.linearRampToValueAtTime(0, t + n.d);
        osc.connect(g);
        g.connect(master);
        osc.start(t);
        osc.stop(t + n.d);
        t += n.d;
      });

      const loopMs = (t - audioCtx.currentTime) * 1000 + 380;
      melodyTimer = setTimeout(() => {
        if (state.musicOn) playWebAudioLoop();
      }, loopMs);
    }

    async function setMusic(on) {
      state.musicOn = on;
      saveStateSafe();

      if (!on) {
        musicToggle.textContent = "üîá Music";
        try { music.pause(); } catch (e) {}
        stopWebAudio();
        return;
      }

      musicToggle.textContent = "üîä Music";
      stopWebAudio();
      music.volume = 0.25;

      try {
        await music.play();
      } catch (e) {
        playWebAudioLoop();
      }
    }

    musicToggle.addEventListener("click", () => setMusic(!state.musicOn));

    // ---------- Quote rotation ----------
    let quoteTimer = null;
    function startQuotes() {
      if (quoteTimer) clearInterval(quoteTimer);
      let i = Math.floor(Math.random() * QUOTES.length);
      quoteText.textContent = '"' + QUOTES[i] + '"';
      quoteTimer = setInterval(() => {
        if (state.step !== 1) return;
        i = (i + 1) % QUOTES.length;
        quoteText.style.opacity = "0";
        quoteText.style.transition = "opacity 0.4s ease, transform 0.4s ease";
        quoteText.style.transform = "translateY(6px)";
        setTimeout(() => {
          quoteText.textContent = '"' + QUOTES[i] + '"';
          quoteText.style.opacity = "1";
          quoteText.style.transform = "translateY(0)";
        }, 400);
      }, 7000);
    }

    // ---------- Particles ----------
    const particleIntervals = [];

    function clearParticles() {
      particleIntervals.forEach(id => clearInterval(id));
      particleIntervals.length = 0;
      particles.innerHTML = "";
    }

    function initParticles() {
      clearParticles();
      if (state.reducedMotion) return;

      const count = window.innerWidth < 520 ? 16 : 24;
      for (let i = 0; i < count; i++) {
        const p = document.createElement("div");
        p.className = "particle" + (Math.random() > 0.5 ? " particle-rose" : "");
        const size = Math.random() * 3 + 1;
        p.style.width = size + "px";
        p.style.height = size + "px";
        p.style.left = Math.random() * 100 + "%";
        p.style.animationDuration = (Math.random() * 10 + 12) + "s";
        p.style.animationDelay = (Math.random() * 8) + "s";
        particles.appendChild(p);
      }
    }

    // ---------- Cursor trail ----------
    document.addEventListener("mousemove", (e) => {
      if (state.reducedMotion) return;
      if (Math.random() < 0.15) {
        const t = document.createElement("div");
        t.className = "cursor-trail";
        t.style.left = e.clientX + "px";
        t.style.top = e.clientY + "px";
        document.body.appendChild(t);
        setTimeout(() => t.remove(), 800);
      }
    }, { passive: true });

    // ---------- Step navigation ----------
    function setProgress() {
      const p = ((state.step - 1) / 2) * 100;
      progressBar.style.width = p + "%";
    }

    function showStep(n) {
      state.step = clamp(n, 1, 3);
      saveStateSafe();

      step1.classList.toggle("active", state.step === 1);
      step2.classList.toggle("active", state.step === 2);
      step3.classList.toggle("active", state.step === 3);

      document.querySelectorAll(".dot").forEach(d => d.classList.remove("active"));
      if (state.step === 1) document.getElementById("dot1").classList.add("active");
      if (state.step === 2) document.getElementById("dot2b").classList.add("active");
      if (state.step === 3) document.getElementById("dot3c").classList.add("active");

      backBtn.classList.toggle("hidden", state.step <= 1);
      setProgress();
    }

    // ---------- Notification ----------
    const notification = document.getElementById("notification");
    let notificationTimer;

    function showNotification(msg, duration) {
      duration = duration || 3000;
      notification.textContent = msg;
      notification.classList.add("show");
      clearTimeout(notificationTimer);
      notificationTimer = setTimeout(() => notification.classList.remove("show"), duration);
    }

    // ---------- Modal ----------
    function showModal(msg) {
      modalText.textContent = msg;
      modalOverlay.style.display = "flex";
      requestAnimationFrame(() => modalOverlay.classList.add("show"));
    }

    function closeModal() {
      modalOverlay.classList.remove("show");
      setTimeout(() => { modalOverlay.style.display = "none"; }, 200);
    }

    modalOk.addEventListener("click", closeModal);
    modalOverlay.addEventListener("click", (e) => {
      if (e.target === modalOverlay) closeModal();
    });

    // ---------- Celebration FX ----------
    const fxIntervals = [];

    function clearCelebrationFx() {
      fxIntervals.forEach(id => clearInterval(id));
      fxIntervals.length = 0;
      celParticles.innerHTML = "";
      celFireworks.innerHTML = "";
    }

    function startCelParticles() {
      const emojis = ["‚ú®", "üíñ", "üíï", "üåπ", "üíó"];
      const spawn = () => {
        const p = document.createElement("div");
        p.className = "cel-particle";
        p.textContent = emojis[Math.floor(Math.random() * emojis.length)];
        p.style.left = Math.random() * 100 + "%";
        p.style.bottom = "0";
        p.style.fontSize = (Math.random() * 14 + 14) + "px";
        p.style.animationDuration = (Math.random() * 3 + 4) + "s";
        p.style.animationDelay = (Math.random() * 0.5) + "s";
        celParticles.appendChild(p);
        setTimeout(() => p.remove(), 6000);
      };
      fxIntervals.push(setInterval(spawn, window.innerWidth < 520 ? 500 : 350));
    }

    function startFireworks() {
      const colors = ["#c4586e", "#d4a574", "#e8c9a0", "#e8829a", "#f5c6d0", "#ffffff"];
      const boom = () => {
        const x = Math.random() * window.innerWidth;
        const y = Math.random() * (window.innerHeight * 0.4) + 60;
        const count = window.innerWidth < 520 ? 14 : 20;
        for (let i = 0; i < count; i++) {
          const f = document.createElement("div");
          f.className = "fw-particle";
          f.style.left = x + "px";
          f.style.top = y + "px";
          f.style.background = colors[Math.floor(Math.random() * colors.length)];
          f.style.boxShadow = "0 0 6px " + f.style.background;
          const angle = (Math.PI * 2 * i) / count;
          const v = 30 + Math.random() * 60;
          f.style.setProperty("--tx", (Math.cos(angle) * v) + "px");
          f.style.setProperty("--ty", (Math.sin(angle) * v) + "px");
          celFireworks.appendChild(f);
          setTimeout(() => f.remove(), 1700);
        }
      };
      fxIntervals.push(setInterval(boom, 1400));
    }

    function showCelebration() {
      state.yes = true;
      saveStateSafe();
      celebration.style.display = "flex";

      // Remove letterbox for full celebration view
      letterboxTop.classList.remove("active");
      letterboxBottom.classList.remove("active");

      clearCelebrationFx();
      if (!state.reducedMotion) {
        startCelParticles();
        startFireworks();
      }
      vibrate(60);
    }

    // ---------- Playful "No" ----------
    function playfulNo(buttonEl) {
      state.noCount += 1;
      saveStateSafe();

      const growFactor = 1 + state.noCount * YES_GROW_INCREMENT;
      const scale = Math.min(growFactor, YES_MAX_SCALE);
      finalYes.style.setProperty("--current-scale", scale);
      finalYes.style.transform = "scale(" + scale + ")";
      finalYes.classList.remove("btn-pulse");
      void finalYes.offsetWidth;
      finalYes.classList.add("btn-pulse");

      const shrink = Math.max(1 - state.noCount * NO_SHRINK_DECREMENT, NO_MIN_SCALE);
      buttonEl.style.transform = "scale(" + shrink + ")";

      const msgIndex = clamp(state.noCount - 1, 0, NO_MESSAGES.length - 1);
      showModal(NO_MESSAGES[msgIndex]);
    }

    // ---------- Content ----------
    function hydrateContent() {
      toLine.textContent = "To " + CONFIG.to;
      fromLine.textContent = "from " + CONFIG.from;
      herNameInline.textContent = CONFIG.to;
      herNameCelebr.textContent = CONFIG.to;

      if (CONFIG.photo) {
        photoEl.src = CONFIG.photo;
        photoEl.onerror = function () {
          this.style.display = "none";
        };
        photoEl.onload = function () {
          photoEl.classList.remove("hidden");
        };
      }

      setDateLine();
    }

    // ---------- Start ----------
    function startExperience(withMusic) {
      startOverlay.style.display = "none";
      app.classList.add("visible");

      hydrateContent();
      syncMotion();
      initParticles();
      startQuotes();

      if (state.yes) {
        showCelebration();
      } else {
        showStep(state.step || 1);
      }

      setMusic(!!withMusic);

      document.querySelectorAll("button").forEach(b => {
        b.addEventListener("click", () => vibrate(18));
      });

      let lastTouchEnd = 0;
      document.addEventListener("touchend", function (event) {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) event.preventDefault();
        lastTouchEnd = now;
      }, { passive: false });
    }

    // ---------- Events ----------
    beginBtn.addEventListener("click", () => startExperience(true));
    muteBtn.addEventListener("click", () => startExperience(false));

    s1Yes.addEventListener("click", () => showStep(2));
    s2Yes.addEventListener("click", () => showStep(3));

    const STEP_NO_MESSAGES = [
      "But... don't you want to know what's next? ü•∫",
      "Are you absolutely sure? There's something special ahead! üíï"
    ];

    s1No.addEventListener("click", () => {
      showModal(STEP_NO_MESSAGES[0]);
      setTimeout(() => showStep(2), 2200);
    });

    s2No.addEventListener("click", () => {
      showModal(STEP_NO_MESSAGES[1]);
      setTimeout(() => showStep(3), 2200);
    });

    finalYes.addEventListener("click", () => showCelebration());
    finalNo.addEventListener("click", () => playfulNo(finalNo));

    backBtn.addEventListener("click", () => {
      if (state.step > 1) showStep(state.step - 1);
    });

    shareBtn.addEventListener("click", async () => {
      try {
        if (navigator.share) {
          await navigator.share({
            title: "\uD83D\uDC95 A Valentine Moment",
            text: "Someone created a special Valentine message!",
            url: window.location.href
          });
          showNotification("Thanks for sharing the love! üíñ");
        } else {
          await navigator.clipboard.writeText(window.location.href);
          showNotification("Link copied to clipboard! üíï");
        }
      } catch (err) {
        if (err.name !== "AbortError") {
          showNotification("Unable to share at this time");
        }
      }
    });

    copyLinkBtn.addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(window.location.href);
        showNotification("Link copied! Share it with your loved ones üíï");
      } catch (err) {
        showModal("Please copy this link manually: " + window.location.href);
      }
    });

    document.addEventListener("keydown", (e) => {
      if (celebration.style.display === "flex") return;
      if (e.key === "Enter" || e.key === "y" || e.key === "Y") {
        if (state.step === 1) s1Yes.click();
        else if (state.step === 2) s2Yes.click();
        else if (state.step === 3) finalYes.click();
      }
    });

    window.addEventListener("resize", () => {
      clearTimeout(window.__resizeTimer);
      window.__resizeTimer = setTimeout(() => initParticles(), 300);
    });

    // ---------- Boot ----------
    runLoader();
  </script>
</body>
</html>
